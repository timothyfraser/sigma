<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Indices and Confidence Intervals for Statistical Process Control in R | System Reliability and Six Sigma in R</title>
  <meta name="description" content="Your online textbook for learning reliability and six sigma techniques in R! Made for Cornell University Course SYSEN 5300." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Indices and Confidence Intervals for Statistical Process Control in R | System Reliability and Six Sigma in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Your online textbook for learning reliability and six sigma techniques in R! Made for Cornell University Course SYSEN 5300." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Indices and Confidence Intervals for Statistical Process Control in R | System Reliability and Six Sigma in R" />
  
  <meta name="twitter:description" content="Your online textbook for learning reliability and six sigma techniques in R! Made for Cornell University Course SYSEN 5300." />
  

<meta name="author" content="Timothy Fraser, PhD" />


<meta name="date" content="2025-09-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>

<script src="assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="assets/kePrint-0.0.1/kePrint.js"></script>
<link href="assets/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><i class="fa fa-check"></i><b>1</b> Indices and Confidence Intervals for Statistical Process Control in <code>R</code></a>
<ul>
<li class="chapter" data-level="" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#getting-started"><i class="fa fa-check"></i>Getting Started</a>
<ul>
<li class="chapter" data-level="" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#packages"><i class="fa fa-check"></i>Packages</a></li>
<li class="chapter" data-level="" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#our-data"><i class="fa fa-check"></i>Our Data</a></li>
</ul></li>
<li class="chapter" data-level="1.1" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#process-capability-vs.-stability"><i class="fa fa-check"></i><b>1.1</b> Process Capability vs. Stability</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#definitions"><i class="fa fa-check"></i><b>1.1.1</b> Definitions</a></li>
<li class="chapter" data-level="1.1.2" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#table-of-indices"><i class="fa fa-check"></i><b>1.1.2</b> Table of Indices</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#index-functions"><i class="fa fa-check"></i><b>1.2</b> Index Functions</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#capacity-index-c_p"><i class="fa fa-check"></i><b>1.2.1</b> Capacity Index <span class="math inline">\(C_{p}\)</span></a></li>
<li class="chapter" data-level="1.2.2" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#process-performance-index-p_p"><i class="fa fa-check"></i><b>1.2.2</b> Process Performance Index <span class="math inline">\(P_{p}\)</span></a></li>
<li class="chapter" data-level="1.2.3" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#capacity-index-c_pk"><i class="fa fa-check"></i><b>1.2.3</b> Capacity Index <span class="math inline">\(C_{pk}\)</span></a></li>
<li class="chapter" data-level="1.2.4" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#process-performance-index-p_pk"><i class="fa fa-check"></i><b>1.2.4</b> Process Performance Index <span class="math inline">\(P_{pk}\)</span></a></li>
<li class="chapter" data-level="1.2.5" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#equality"><i class="fa fa-check"></i><b>1.2.5</b> Equality</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#learning-check-1"><i class="fa fa-check"></i>Learning Check 1</a></li>
<li class="chapter" data-level="1.3" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#confidence-intervals"><i class="fa fa-check"></i><b>1.3</b> Confidence Intervals</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#confidence-intervals-show-us-sampling-distributions"><i class="fa fa-check"></i><b>1.3.1</b> Confidence Intervals show us Sampling Distributions</a></li>
<li class="chapter" data-level="1.3.2" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#bootstrapped-or-theoretical-sampling-distributions"><i class="fa fa-check"></i><b>1.3.2</b> Bootstrapped or Theoretical Sampling Distributions?</a></li>
<li class="chapter" data-level="1.3.3" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#confidence-intervals-with-theoretical-sampling-distributions"><i class="fa fa-check"></i><b>1.3.3</b> Confidence Intervals with Theoretical Sampling Distributions</a></li>
<li class="chapter" data-level="1.3.4" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#visualizing-confidence-intervals"><i class="fa fa-check"></i><b>1.3.4</b> Visualizing Confidence Intervals</a></li>
<li class="chapter" data-level="1.3.5" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#bootstrapping-c_p"><i class="fa fa-check"></i><b>1.3.5</b> Bootstrapping <span class="math inline">\(C_{p}\)</span></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cis-for-any-index"><i class="fa fa-check"></i><b>1.4</b> CIs for any Index!</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cis-for-p_p"><i class="fa fa-check"></i><b>1.4.1</b> CIs for <span class="math inline">\(P_p\)</span></a></li>
<li class="chapter" data-level="1.4.2" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cis-for-c_pk"><i class="fa fa-check"></i><b>1.4.2</b> CIs for <span class="math inline">\(C_{pk}\)</span></a></li>
<li class="chapter" data-level="1.4.3" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cis-for-p_p-1"><i class="fa fa-check"></i><b>1.4.3</b> CIs for <span class="math inline">\(P_p\)</span></a></li>
<li class="chapter" data-level="1.4.4" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cis-for-p_pk"><i class="fa fa-check"></i><b>1.4.4</b> CIs for <span class="math inline">\(P_{pk}\)</span></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="indices-and-confidence-intervals-for-statistical-process-control-in-r.html"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#conclusion"><i class="fa fa-check"></i>Conclusion</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">System Reliability and Six Sigma in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="indices-and-confidence-intervals-for-statistical-process-control-in-r" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">1</span> Indices and Confidence Intervals for Statistical Process Control in <code>R</code><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#indices-and-confidence-intervals-for-statistical-process-control-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-1"></span>
<img src="images/10_cover.png" alt="Bootstrapping Sampling Distributions for Statistics!!" width="100%" />
<p class="caption">
Figure 1.1: Bootstrapping Sampling Distributions for Statistics!!
</p>
</div>
<p>This workshop extends our toolkit developed in Workshop 9, discussing Process Capability and Stability Indices, and introducing means to calculate confidence intervals for these indices.</p>
<div id="getting-started" class="section level2 unnumbered hasAnchor">
<h2>Getting Started<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#getting-started" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="packages" class="section level3 unnumbered hasAnchor">
<h3>Packages<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#packages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We’ll be using the <code>tidyverse</code> package for visualization, <code>viridis</code> for color palletes, <code>moments</code> for descriptive statistics, plus <code>ggpubr</code> for some add-on functions in <code>ggplot</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb1-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb1-2" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb1-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb1-3" tabindex="-1"></a><span class="co"># you&#39;ll probably need to install these packages!</span></span>
<span id="cb1-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb1-4" tabindex="-1"></a><span class="co"># install.packages(c(&quot;ggpubr&quot;, &quot;moments&quot;)) </span></span></code></pre></div>
</div>
<div id="our-data" class="section level3 unnumbered hasAnchor">
<h3>Our Data<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#our-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We’ll be continuing to analyze our quality control data from a local hot springs inn (<em>onsen</em>) in sunny Kagoshima Prefecture, Japan. Every month, for 15 months, you systematically took 20 random samples of hot spring water and recorded its <strong>temperature</strong>, <strong>pH</strong>, and <strong>sulfur</strong> levels. How might you determine if this <em>onsen</em> is at risk of slipping out of one sector of the market (eg. Extra Hot!) and into another (just normal Hot Springs?).</p>
<p>Let’s read in our data from <code>workshops/onsen.csv</code>!</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb2-1" tabindex="-1"></a><span class="co"># Let&#39;s import our samples of bathwater over time!</span></span>
<span id="cb2-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb2-2" tabindex="-1"></a>water <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">&quot;workshops/onsen.csv&quot;</span>)</span>
<span id="cb2-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb2-3" tabindex="-1"></a><span class="co"># Take a peek!</span></span>
<span id="cb2-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb2-4" tabindex="-1"></a>water <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 160
## Columns: 5
## $ id     &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, …
## $ time   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, …
## $ temp   &lt;dbl&gt; 43.2, 45.3, 45.5, 43.9, 45.9, 45.0, 42.3, 44.2, 42.2, 43.4, 46.…
## $ ph     &lt;dbl&gt; 5.1, 4.8, 6.2, 6.4, 5.1, 5.6, 5.5, 5.3, 5.2, 5.9, 5.8, 5.3, 5.9…
## $ sulfur &lt;dbl&gt; 0.0, 0.4, 0.9, 0.2, 0.0, 0.1, 0.0, 0.0, 0.0, 0.1, 0.7, 1.1, 0.1…</code></pre>
<p>Our dataset contains:</p>
<ul>
<li><p><code>id</code>: unique identifer for each sample of <em>onsen</em> water.</p></li>
<li><p><code>time</code>: categorical variable describing date of sample (month <code>1</code>, month <code>3</code>, … month <code>15</code>).</p></li>
<li><p><code>temp</code>: temperature in celsius.</p></li>
<li><p><code>ph</code>: pH (0 to 14)</p></li>
<li><p><code>sulfur</code>: milligrams of sulfur ions.</p></li>
</ul>
<p><br>
<br></p>
</div>
</div>
<div id="process-capability-vs.-stability" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Process Capability vs. Stability<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#process-capability-vs.-stability" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="definitions" class="section level3 hasAnchor" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Definitions<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#definitions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Production processes can be categorized in terms of <strong>Capability</strong> (does it meet required specifications?) and <strong>Stability</strong> (is production consistent and predictable?) Both are vital.</p>
<ul>
<li><p>A <strong>capable</strong> process delivers goods that can actually perform their function, like a 20-foot ladder that is <em>actually</em> 20 feet!</p></li>
<li><p>A <strong>stable</strong> process delivers products with <em>consistent</em> and predictable traits (regardless of whether those traits are <em>good</em>).</p></li>
</ul>
<p>We need to maximize <em>both</em> process <strong>capability</strong> and <strong>stability</strong> to make an effective process, be it in manufacturing, health care, local businesses, or social life! Depending on the <em>shape</em> and <em>stability</em> of our data, we should choose one of the 4 statistics to evaluate our data.</p>
<p><br>
<br></p>
</div>
<div id="table-of-indices" class="section level3 hasAnchor" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Table of Indices<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#table-of-indices" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>These statistics rely on some combination of (1) the mean <span class="math inline">\(\mu\)</span>, (2) the standard deviation <span class="math inline">\(\sigma\)</span>, and (3) the upper and lower <strong>“specification limits”</strong>; the specification limits are our <strong>expected values</strong> <span class="math inline">\(E_{upper}\)</span> and <span class="math inline">\(E_{lower}\)</span>, as compared to our actual <strong>observed values</strong>, summarized by <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>.</p>
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Index
</th>
<th style="text-align:left;">
Shape
</th>
<th style="text-align:left;">
Sided
</th>
<th style="text-align:left;">
Stability
</th>
<th style="text-align:left;">
Formula
</th>
<th style="text-align:left;">
Meaning
</th>
</tr>
</thead>
<tbody>
<tr grouplength="2">
<td colspan="6" style="border-bottom: 1px solid;">
<strong>Capability Indices (How <span class="math inline">\(\textit{could}\)</span> it perform, if stable?)</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
<span class="math inline">\(C_{p}\)</span>
</td>
<td style="text-align:left;">
Centered
</td>
<td style="text-align:left;">
2-sided
</td>
<td style="text-align:left;">
Stable
</td>
<td style="text-align:left;">
<span class="math inline">\(\frac{E_{upper} - E_{lower}}{6 \sigma_{short}}\)</span>
</td>
<td style="text-align:left;">
How many times wider is the expected range than the observed range, assuming it is stable?
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
<span class="math inline">\(C_{pk}\)</span>
</td>
<td style="text-align:left;">
Uncentered
</td>
<td style="text-align:left;">
1-sided
</td>
<td style="text-align:left;">
Stable
</td>
<td style="text-align:left;">
<span class="math inline">\(\frac{\mid E_{limit} - \mu \mid}{3 \sigma_{short}}\)</span>
</td>
<td style="text-align:left;">
How many times wider is the expected vs. observed range for the left/right side, assuming it is stable?
</td>
</tr>
<tr grouplength="2">
<td colspan="6" style="border-bottom: 1px solid;">
<strong>Process Performance Indices (How is it performing, stable or not?)</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
<span class="math inline">\(P_{p}\)</span>
</td>
<td style="text-align:left;">
Centered
</td>
<td style="text-align:left;">
2-sided
</td>
<td style="text-align:left;">
Unstable
</td>
<td style="text-align:left;">
<span class="math inline">\(\frac{E_{upper} - E_{lower}}{6 \sigma_{total}}\)</span>
</td>
<td style="text-align:left;">
How many times wider is the expected vs. observed range, stable or not?
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
<span class="math inline">\(P_{pk}\)</span>
</td>
<td style="text-align:left;">
Uncentered
</td>
<td style="text-align:left;">
1-sided
</td>
<td style="text-align:left;">
Unstable
</td>
<td style="text-align:left;">
<span class="math inline">\(\frac{\mid E_{limit} - \mu \mid}{3 \sigma_{total}}\)</span>
</td>
<td style="text-align:left;">
How many times wider is the expected vs. observed range for the left/right side, stable or not?
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="index-functions" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Index Functions<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#index-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s do ourselves a favor and write up some simple functions for these.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-1" tabindex="-1"></a><span class="co"># Capability Index (for centered, normal data)</span></span>
<span id="cb4-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-2" tabindex="-1"></a>cp <span class="ot">=</span> <span class="cf">function</span>(sigma_s, upper, lower){  <span class="fu">abs</span>(upper <span class="sc">-</span> lower) <span class="sc">/</span> (<span class="dv">6</span><span class="sc">*</span>sigma_s)   }</span>
<span id="cb4-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-4" tabindex="-1"></a><span class="co"># Process Performance Index (for centered, normal data)</span></span>
<span id="cb4-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-5" tabindex="-1"></a>pp <span class="ot">=</span> <span class="cf">function</span>(sigma_t, upper, lower){  <span class="fu">abs</span>(upper <span class="sc">-</span> lower) <span class="sc">/</span> (<span class="dv">6</span><span class="sc">*</span>sigma_t)   }</span>
<span id="cb4-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-7" tabindex="-1"></a><span class="co"># Capability Index (for skewed, uncentered data)</span></span>
<span id="cb4-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-8" tabindex="-1"></a>cpk <span class="ot">=</span> <span class="cf">function</span>(mu, sigma_s, <span class="at">lower =</span> <span class="cn">NULL</span>, <span class="at">upper =</span> <span class="cn">NULL</span>){</span>
<span id="cb4-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-9" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(lower)){</span>
<span id="cb4-10"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-10" tabindex="-1"></a>    a <span class="ot">=</span> <span class="fu">abs</span>(mu <span class="sc">-</span> lower) <span class="sc">/</span> (<span class="dv">3</span> <span class="sc">*</span> sigma_s)</span>
<span id="cb4-11"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-11" tabindex="-1"></a>  }</span>
<span id="cb4-12"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-12" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(upper)){</span>
<span id="cb4-13"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-13" tabindex="-1"></a>    b <span class="ot">=</span> <span class="fu">abs</span>(upper <span class="sc">-</span> mu) <span class="sc">/</span>  (<span class="dv">3</span> <span class="sc">*</span> sigma_s)</span>
<span id="cb4-14"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-14" tabindex="-1"></a>  }</span>
<span id="cb4-15"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-15" tabindex="-1"></a>  <span class="co"># We can also write if else statements like this</span></span>
<span id="cb4-16"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-16" tabindex="-1"></a>  <span class="co"># If we got both stats, return the min!</span></span>
<span id="cb4-17"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-17" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(lower) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(upper)){</span>
<span id="cb4-18"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-18" tabindex="-1"></a>    <span class="fu">min</span>(a,b) <span class="sc">%&gt;%</span> <span class="fu">return</span>()</span>
<span id="cb4-19"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-19" tabindex="-1"></a>    </span>
<span id="cb4-20"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-20" tabindex="-1"></a>    <span class="co"># If we got just the upper stat, return b (for upper)</span></span>
<span id="cb4-21"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-21" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">is.null</span>(lower)){ <span class="fu">return</span>(b) </span>
<span id="cb4-22"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-22" tabindex="-1"></a>    </span>
<span id="cb4-23"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-23" tabindex="-1"></a>    <span class="co"># If we got just the lower stat, return a (for lower)</span></span>
<span id="cb4-24"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-24" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">is.null</span>(upper)){ <span class="fu">return</span>(a) }</span>
<span id="cb4-25"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-25" tabindex="-1"></a>}</span>
<span id="cb4-26"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-26" tabindex="-1"></a></span>
<span id="cb4-27"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-27" tabindex="-1"></a></span>
<span id="cb4-28"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-28" tabindex="-1"></a><span class="co"># Process Performance Index (for skewed, uncentered data)</span></span>
<span id="cb4-29"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-29" tabindex="-1"></a>ppk <span class="ot">=</span> <span class="cf">function</span>(mu, sigma_t, <span class="at">lower =</span> <span class="cn">NULL</span>, <span class="at">upper =</span> <span class="cn">NULL</span>){</span>
<span id="cb4-30"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-30" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(lower)){</span>
<span id="cb4-31"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-31" tabindex="-1"></a>    a <span class="ot">=</span> <span class="fu">abs</span>(mu <span class="sc">-</span> lower) <span class="sc">/</span> (<span class="dv">3</span> <span class="sc">*</span> sigma_t)</span>
<span id="cb4-32"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-32" tabindex="-1"></a>  }</span>
<span id="cb4-33"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-33" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(upper)){</span>
<span id="cb4-34"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-34" tabindex="-1"></a>    b <span class="ot">=</span> <span class="fu">abs</span>(upper <span class="sc">-</span> mu) <span class="sc">/</span>  (<span class="dv">3</span> <span class="sc">*</span> sigma_t)</span>
<span id="cb4-35"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-35" tabindex="-1"></a>  }</span>
<span id="cb4-36"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-36" tabindex="-1"></a>  <span class="co"># We can also write if else statements like this</span></span>
<span id="cb4-37"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-37" tabindex="-1"></a>  <span class="co"># If we got both stats, return the min!</span></span>
<span id="cb4-38"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-38" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(lower) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(upper)){</span>
<span id="cb4-39"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-39" tabindex="-1"></a>    <span class="fu">min</span>(a,b) <span class="sc">%&gt;%</span> <span class="fu">return</span>()</span>
<span id="cb4-40"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-40" tabindex="-1"></a>    </span>
<span id="cb4-41"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-41" tabindex="-1"></a>    <span class="co"># If we got just the upper stat, return b (for upper)</span></span>
<span id="cb4-42"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-42" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">is.null</span>(lower)){ <span class="fu">return</span>(b) </span>
<span id="cb4-43"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-43" tabindex="-1"></a>    </span>
<span id="cb4-44"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-44" tabindex="-1"></a>    <span class="co"># If we got just the lower stat, return a (for lower)</span></span>
<span id="cb4-45"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-45" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">is.null</span>(upper)){ <span class="fu">return</span>(a) }</span>
<span id="cb4-46"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb4-46" tabindex="-1"></a>}</span></code></pre></div>
<p><br>
<br></p>
<p>How might we use these indices to describe our process data? For example, recall that our <em>onsen</em> operator needs to be sure that their hot springs water is consistently falling into the temperature bins for <em>Extra Hot Springs</em>, which start at 42 degrees Celsius (and go as high as <code>80</code>). Let’s use those as our specification limits (pretty easy-going limits, I might add).</p>
<p>Let’s start by calculating our quantities of interest.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-1" tabindex="-1"></a>stat <span class="ot">=</span> water <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-2" tabindex="-1"></a>  <span class="fu">group_by</span>(time) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-3" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb5-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-4" tabindex="-1"></a>    <span class="at">xbar =</span> <span class="fu">mean</span>(temp),  <span class="co"># Get within group mean</span></span>
<span id="cb5-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-5" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">sd</span>(temp),  <span class="co"># Get within group sigma</span></span>
<span id="cb5-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-6" tabindex="-1"></a>    <span class="at">n_w =</span> <span class="fu">n</span>()             <span class="co"># Get within subgroup size</span></span>
<span id="cb5-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-8" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb5-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-9" tabindex="-1"></a>    <span class="at">xbbar =</span> <span class="fu">mean</span>(xbar),               <span class="co"># Get grand mean</span></span>
<span id="cb5-10"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-10" tabindex="-1"></a>    <span class="at">sigma_s =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(sd<span class="sc">^</span><span class="dv">2</span>)), <span class="co"># Get sigma_short</span></span>
<span id="cb5-11"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-11" tabindex="-1"></a>    <span class="at">sigma_t =</span> <span class="fu">sd</span>(water<span class="sc">$</span>temp), <span class="co"># get sigma_total</span></span>
<span id="cb5-12"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-12" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">sum</span>(n_w), <span class="co"># Get total observations</span></span>
<span id="cb5-13"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-13" tabindex="-1"></a>    <span class="at">n_w =</span> <span class="fu">unique</span>(n_w), <span class="co"># get size of subgroups</span></span>
<span id="cb5-14"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-14" tabindex="-1"></a>    <span class="at">k =</span> <span class="fu">n</span>())   <span class="co"># Get number of subgroups k</span></span>
<span id="cb5-15"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-15" tabindex="-1"></a><span class="co"># Check it!</span></span>
<span id="cb5-16"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb5-16" tabindex="-1"></a>stat</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   xbbar sigma_s sigma_t     n   n_w     k
##   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1  44.8    1.99    1.99   160    20     8</code></pre>
<div id="capacity-index-c_p" class="section level3 hasAnchor" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Capacity Index <span class="math inline">\(C_{p}\)</span><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#capacity-index-c_p" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Our <span class="math inline">\(C_{p}\)</span> Capacity index says, assuming that the distribution is centered and stable, how many times wider are our limits than our approximate observed distribution (<span class="math inline">\(6 \sigma_{short}\)</span>)?</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb7-1" tabindex="-1"></a>mycp <span class="ot">=</span> <span class="fu">cp</span>(<span class="at">sigma_s =</span> stat<span class="sc">$</span>sigma_s, <span class="at">lower =</span> <span class="dv">42</span>, <span class="at">upper =</span> <span class="dv">80</span>)</span>
<span id="cb7-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb7-3" tabindex="-1"></a><span class="co"># Check it!</span></span>
<span id="cb7-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb7-4" tabindex="-1"></a>mycp</span></code></pre></div>
<pre><code>## [1] 3.18871</code></pre>
<p>Great! This says, our observed variation is many times (3.1887098 times) narrower than the expected specification limits.</p>
<p><br></p>
</div>
<div id="process-performance-index-p_p" class="section level3 hasAnchor" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Process Performance Index <span class="math inline">\(P_{p}\)</span><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#process-performance-index-p_p" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Our <span class="math inline">\(P_{p}\)</span> Process Performance Index asks, even if the distribution is not stable (meaning it varies not just due to common causes), how many times wider are our specification limits than our approximate observed distribution (<span class="math inline">\(6 \sigma_{total}\)</span>)?</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb9-1" tabindex="-1"></a>mypp <span class="ot">=</span> <span class="fu">pp</span>(<span class="at">sigma_t =</span> stat<span class="sc">$</span>sigma_t, <span class="at">lower =</span> <span class="dv">42</span>, <span class="at">upper =</span> <span class="dv">80</span>)</span>
<span id="cb9-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb9-2" tabindex="-1"></a>mypp</span></code></pre></div>
<pre><code>## [1] 3.183378</code></pre>
<p>Much like before, the specification limit range remains quite bigger than the observed distribution.</p>
<p><br></p>
</div>
<div id="capacity-index-c_pk" class="section level3 hasAnchor" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> Capacity Index <span class="math inline">\(C_{pk}\)</span><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#capacity-index-c_pk" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Our <span class="math inline">\(C_{pk}\)</span> Capacity index says, assuming the distribution is pretty stable across subgroups, how many times wider is (a) the distance from the tail of interest to the mean than (b) our approximate observed tail (3 sigma)? This always looks at the <em>shorter tail</em>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb11-1" tabindex="-1"></a>mycpk <span class="ot">=</span> <span class="fu">cpk</span>(<span class="at">sigma_s =</span> stat<span class="sc">$</span>sigma_s, <span class="at">mu =</span> stat<span class="sc">$</span>xbbar, <span class="at">lower =</span> <span class="dv">42</span>, <span class="at">upper =</span> <span class="dv">80</span>)</span>
<span id="cb11-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb11-2" tabindex="-1"></a>mycpk</span></code></pre></div>
<pre><code>## [1] 0.4783065</code></pre>
<p>If we only care about one of the tails, eg. the lower specification limit of 42, which is much closer than the upper limit of 80, we can just write the lower limit only.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb13-1" tabindex="-1"></a><span class="fu">cpk</span>(<span class="at">sigma_s =</span> stat<span class="sc">$</span>sigma_s, <span class="at">mu =</span> stat<span class="sc">$</span>xbbar, <span class="at">lower =</span> <span class="dv">42</span>)</span></code></pre></div>
<pre><code>## [1] 0.4783065</code></pre>
<p>This says, our observed variation is much wider than the lower specification limit, since <span class="math inline">\(C_{pk}\)</span> is far from <code>1</code>, which which show equality.</p>
<p><br>
<br></p>
</div>
<div id="process-performance-index-p_pk" class="section level3 hasAnchor" number="1.2.4">
<h3><span class="header-section-number">1.2.4</span> Process Performance Index <span class="math inline">\(P_{pk}\)</span><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#process-performance-index-p_pk" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Our <span class="math inline">\(P_{pk}\)</span> process performance index says, even if the distribution is neither stable nor centered, how much wider is the observed variation <span class="math inline">\(3 \sigma_{total}\)</span> than the distance from the tail of interest to the mean? We use <span class="math inline">\(\sigma_{total}\)</span> here to account for instability (considerable variation between subgroups) and one-tailed testing to account for the uncentered distribution.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb15-1" tabindex="-1"></a>myppk <span class="ot">=</span> <span class="fu">ppk</span>(<span class="at">sigma_t =</span> stat<span class="sc">$</span>sigma_t, <span class="at">mu =</span> stat<span class="sc">$</span>xbbar, <span class="at">lower =</span> <span class="dv">42</span>, <span class="at">upper =</span> <span class="dv">80</span>)</span>
<span id="cb15-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb15-2" tabindex="-1"></a>myppk</span></code></pre></div>
<pre><code>## [1] 0.4775067</code></pre>
</div>
<div id="equality" class="section level3 hasAnchor" number="1.2.5">
<h3><span class="header-section-number">1.2.5</span> Equality<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#equality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A final reason why these quantities are neat is that these 4 indices are related; if you know 3 of them, we can always calculate the 4th! See the identity below:</p>
<p><span class="math display">\[P_{p} \times C_{pk} = P_{pk} \times C_{p}\]</span></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb17-1" tabindex="-1"></a><span class="co"># whaaaaaat? They&#39;re equal!!!! </span></span>
<span id="cb17-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb17-2" tabindex="-1"></a>mypp <span class="sc">*</span> mycpk <span class="sc">==</span> myppk <span class="sc">*</span> mycp</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><br>
<br></p>
<hr />
</div>
</div>
<div id="learning-check-1" class="section level2 unnumbered LC hasAnchor">
<h2>Learning Check 1<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#learning-check-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Question</strong></p>
<p>Let’s apply this to some tasty examples! A manufacturer of granola bars is aiming for a weight of <code>2 ounces (oz)</code>, plus or minus <code>0.5 oz</code>. Suppose the standard deviation of our granola bar machine is <code>0.02 oz</code>, and the mean weight is <code>2.01 oz</code>.</p>
<p>What’s the process capability index? (I.e. How many times greater is the expected variation than the observed variation?)</p>
<details>
<summary>
<strong>[View Answer!]</strong>
</summary>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb19-1" tabindex="-1"></a>lower <span class="ot">=</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.05</span></span>
<span id="cb19-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb19-2" tabindex="-1"></a>upper <span class="ot">=</span> <span class="dv">2</span> <span class="sc">-</span> <span class="fl">0.05</span></span>
<span id="cb19-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb19-3" tabindex="-1"></a>sigma <span class="ot">=</span> <span class="fl">0.02</span></span>
<span id="cb19-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb19-4" tabindex="-1"></a>mu <span class="ot">=</span> <span class="fl">2.01</span></span>
<span id="cb19-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb19-5" tabindex="-1"></a></span>
<span id="cb19-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb19-7" tabindex="-1"></a><span class="fu">cp</span>(<span class="at">sigma =</span> <span class="fl">0.02</span>, <span class="at">upper =</span> <span class="fl">2.05</span>, <span class="at">lower =</span> <span class="fl">1.95</span>)</span></code></pre></div>
<pre><code>## [1] 0.8333333</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb21-1" tabindex="-1"></a><span class="fu">cpk</span>(<span class="at">mu =</span> <span class="fl">2.01</span>, <span class="at">sigma =</span> <span class="fl">0.02</span>, <span class="at">lower =</span> <span class="fl">1.95</span>, <span class="at">upper =</span> <span class="fl">2.05</span>)</span></code></pre></div>
<pre><code>## [1] 0.6666667</code></pre>
</details>
<hr />
<p><br>
<br></p>
</div>
<div id="confidence-intervals" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Confidence Intervals<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#confidence-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Any statistic is really just 1 of the many possible values of statistics you could have gotten from your sample, had you taken just a slightly different random sample. So, when we calculate our indices, we should be prepared that our indices might <em>vary due to chance (sampling error)</em>, so we should build in confidence intervals. This helps us benchmark how trustworthy any given index is.</p>
<p><br>
<br></p>
<div id="confidence-intervals-show-us-sampling-distributions" class="section level3 hasAnchor" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Confidence Intervals show us Sampling Distributions<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#confidence-intervals-show-us-sampling-distributions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s quickly go over what confidence intervals are trying to show us!</p>
<p>Suppose we take a statistic like the mean <span class="math inline">\(\mu\)</span> to describe our vector <code>temp</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb23-1" tabindex="-1"></a>water <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb23-2" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(temp))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##    mean
##   &lt;dbl&gt;
## 1  44.8</code></pre>
<p>We might have gotten a <em>slightly</em> different statistic had we had a <em>slightly</em> different sample. We can approximate what <em>slightly</em> different sample might look like by using <em>bootstrapped resamples</em>. This means, randomly sampling a bunch of observations from our dataframe <code>water</code>, sometimes taking the same observation multiple times, sometimes leaving out some observations by chance. We can use the <code>sample(x, size = ..., replace = TRUE)</code> function to take a <strong>bootstrapped sample</strong>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb25-1" tabindex="-1"></a>water <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb25-2" tabindex="-1"></a>  <span class="co"># Grab n() randomly sampled temperatures, with replacement,</span></span>
<span id="cb25-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb25-3" tabindex="-1"></a>  <span class="co"># we&#39;ll call those &#39;boot&#39;, since they were &#39;bootstrapped&#39;</span></span>
<span id="cb25-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb25-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">boot =</span> <span class="fu">sample</span>(temp, <span class="at">size =</span> <span class="fu">n</span>(), <span class="at">replace =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb25-5" tabindex="-1"></a>  <span class="co"># and take the mean!</span></span>
<span id="cb25-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb25-6" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(boot))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##    mean
##   &lt;dbl&gt;
## 1  45.0</code></pre>
<p>Our bootstrapped <code>mean</code> is <em>very</em>, <em>very</em> close to the original mean - just slightly off due to sampling error! Bootstrapping is a very powerful tool, as it lets us circumvent many long formulas, as long as you take enough samples. Let’s take 1000 resamples below:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb27-1" tabindex="-1"></a><span class="co"># Get a vector of ids from 1 to 1000</span></span>
<span id="cb27-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb27-2" tabindex="-1"></a>myboot <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb27-3" tabindex="-1"></a>  <span class="co"># For each repetition,</span></span>
<span id="cb27-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb27-4" tabindex="-1"></a>  <span class="fu">group_by</span>(rep) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb27-5" tabindex="-1"></a>  <span class="co"># Get a random bootstrapped sample of temperatures</span></span>
<span id="cb27-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb27-6" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">boot =</span> water<span class="sc">$</span>temp <span class="sc">%&gt;%</span> <span class="fu">sample</span>(<span class="at">size =</span> <span class="fu">n</span>(), <span class="at">replace =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb27-7" tabindex="-1"></a>  <span class="co"># For that repetition,</span></span>
<span id="cb27-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb27-8" tabindex="-1"></a>  <span class="fu">group_by</span>(rep) <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb27-9" tabindex="-1"></a>  <span class="co"># Calculate the mean of the bootstrapped samples!</span></span>
<span id="cb27-10"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb27-10" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(boot))</span>
<span id="cb27-11"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb27-11" tabindex="-1"></a></span>
<span id="cb27-12"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb27-12" tabindex="-1"></a><span class="co"># Let&#39;s view them!</span></span>
<span id="cb27-13"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb27-13" tabindex="-1"></a>myboot<span class="sc">$</span>mean <span class="sc">%&gt;%</span> <span class="fu">hist</span>()</span></code></pre></div>
<p><img src="06_workshop_files/figure-html/unnamed-chunk-15-1.png" width="672" />
We can see above the <em>latent distribution of 1000 statistics we could have gotten due to random sampling error</em>. This is called a <strong>sampling distribution</strong>. Whenever we make confidence intervals, we are <em>always</em> drawing from a <strong>sampling distribution</strong>.</p>
<p><br>
<br></p>
</div>
<div id="bootstrapped-or-theoretical-sampling-distributions" class="section level3 hasAnchor" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Bootstrapped or Theoretical Sampling Distributions?<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#bootstrapped-or-theoretical-sampling-distributions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The question is, are you relying on a <em>bootstrapped</em> sampling distribution or a <em>theoretical</em> sampling distribution?</p>
<ul>
<li><p>If we assume a perfectly <em>normal</em> distribution, then we’re relying on a theoretical sampling distribution, and we need formulas to calculate our confidence intervals. This is a big assumption!</p></li>
<li><p>If we are comfortable with computing 1000 or more replicates, then we can bootstrap those confidence intervals instead, gaining accuracy at the expense of computational power.</p></li>
</ul>
<p>Let’s learn how to make confidence intervals for our indices from (1) a theoretical sampling distribution, and then we’ll learn to make them from (2) a bootstrapped sampling distribution.</p>
<p><br>
<br></p>
</div>
<div id="confidence-intervals-with-theoretical-sampling-distributions" class="section level3 hasAnchor" number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> Confidence Intervals with Theoretical Sampling Distributions<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#confidence-intervals-with-theoretical-sampling-distributions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose our lower and upper specification limits - the expectations of the market and/or regulators - are that our <em>onsen</em>’s temperature should be between 42 and 50 degrees Celsius if we advertise ourselves as an Extra Hot Onsen.</p>
<p>For any index, you’ll need to get the ingredients needed to calculate the index and to calculate its <em>standard error</em> (the standard deviation of the sampling distribution you’re trying to approximate).</p>
<p>So, let’s first get our ingredients…</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-1" tabindex="-1"></a>stat <span class="ot">=</span> water <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-2" tabindex="-1"></a>  <span class="fu">group_by</span>(time) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">xbar =</span> <span class="fu">mean</span>(temp),</span>
<span id="cb28-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-4" tabindex="-1"></a>            <span class="at">s =</span> <span class="fu">sd</span>(temp),</span>
<span id="cb28-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-5" tabindex="-1"></a>            <span class="at">n_w =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-6" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb28-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-7" tabindex="-1"></a>    <span class="at">xbbar =</span> <span class="fu">mean</span>(xbar), <span class="co"># grand mean x-double-bar</span></span>
<span id="cb28-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-8" tabindex="-1"></a>    <span class="at">sigma_s =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(s<span class="sc">^</span><span class="dv">2</span>)), <span class="co"># sigma_short</span></span>
<span id="cb28-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-9" tabindex="-1"></a>    <span class="at">sigma_t =</span> water<span class="sc">$</span>temp <span class="sc">%&gt;%</span> <span class="fu">sd</span>(), <span class="co"># sigma_total!</span></span>
<span id="cb28-10"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-10" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">sum</span>(n_w), <span class="co"># or just n = n()   # Total sample size</span></span>
<span id="cb28-11"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-11" tabindex="-1"></a>    <span class="at">n_w =</span> <span class="fu">unique</span>(n_w),</span>
<span id="cb28-12"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-12" tabindex="-1"></a>    <span class="at">k =</span> time <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">length</span>())   <span class="co"># Get total subgroups</span></span>
<span id="cb28-13"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-13" tabindex="-1"></a></span>
<span id="cb28-14"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-14" tabindex="-1"></a><span class="co"># Check it!</span></span>
<span id="cb28-15"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb28-15" tabindex="-1"></a>stat</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   xbbar sigma_s sigma_t     n   n_w     k
##   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1  44.8    1.99    1.99   160    20     8</code></pre>
<p>Now, let’s calculate our Capability Index <span class="math inline">\(C_{p}\)</span>, which assumes a process <em>centered</em> between the upper and lower specification limits and a <em>stable</em> process.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb30-1" tabindex="-1"></a><span class="co"># Capability Index (for centered, normal data)</span></span>
<span id="cb30-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb30-2" tabindex="-1"></a>cp <span class="ot">=</span> <span class="cf">function</span>(sigma_s, upper, lower){  <span class="fu">abs</span>(upper <span class="sc">-</span> lower) <span class="sc">/</span> (<span class="dv">6</span><span class="sc">*</span>sigma_s)   }</span>
<span id="cb30-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb30-3" tabindex="-1"></a></span>
<span id="cb30-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb30-4" tabindex="-1"></a></span>
<span id="cb30-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb30-5" tabindex="-1"></a>stat <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb30-6" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb30-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb30-7" tabindex="-1"></a>    <span class="at">limit_lower =</span> <span class="dv">42</span>,</span>
<span id="cb30-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb30-8" tabindex="-1"></a>    <span class="at">limit_upper =</span> <span class="dv">50</span>,</span>
<span id="cb30-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb30-9" tabindex="-1"></a>    <span class="co"># index</span></span>
<span id="cb30-10"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb30-10" tabindex="-1"></a>    <span class="at">estimate =</span> <span class="fu">cp</span>(<span class="at">sigma_s =</span> sigma_s, <span class="at">lower =</span> limit_lower, <span class="at">upper =</span> limit_upper))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   limit_lower limit_upper estimate
##         &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;
## 1          42          50    0.671</code></pre>
<p>That was surprisingly painless!</p>
<p>Now, let’s estimate the two-sided, 95% confidence interval of our sampling distribution for the statistic <code>cp</code>, assuming that this sampling distribution has a <em>normal</em> shape.</p>
<p>We’re getting the interval that spans 95%, so it’s got to start at 2.5% and end at 97.5%, covering the 95% <em>most frequently occurring statistics</em> in the sampling distribution.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-1" tabindex="-1"></a>bands <span class="ot">=</span> stat <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-2" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb32-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-3" tabindex="-1"></a>    <span class="at">limit_lower =</span> <span class="dv">42</span>,</span>
<span id="cb32-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-4" tabindex="-1"></a>    <span class="at">limit_upper =</span> <span class="dv">50</span>,</span>
<span id="cb32-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-5" tabindex="-1"></a>    <span class="co"># index</span></span>
<span id="cb32-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-6" tabindex="-1"></a>    <span class="at">estimate =</span> <span class="fu">cp</span>(<span class="at">sigma_s =</span> sigma_s, <span class="at">lower =</span> limit_lower, <span class="at">upper =</span> limit_upper),</span>
<span id="cb32-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-7" tabindex="-1"></a>    <span class="co"># Get our extra quantities of interest</span></span>
<span id="cb32-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-8" tabindex="-1"></a>    <span class="at">v_short =</span> k<span class="sc">*</span>(n_w <span class="sc">-</span> <span class="dv">1</span>), <span class="co"># get degrees of freedom</span></span>
<span id="cb32-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-9" tabindex="-1"></a>    <span class="co"># Get standard error for estimate</span></span>
<span id="cb32-10"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-10" tabindex="-1"></a>    <span class="at">se =</span> estimate <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span><span class="sc">*</span>v_short)),</span>
<span id="cb32-11"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-11" tabindex="-1"></a>    <span class="co"># Get z score</span></span>
<span id="cb32-12"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-12" tabindex="-1"></a>    <span class="at">z =</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>), <span class="co"># get position of 97.5th percentile in normal distribution</span></span>
<span id="cb32-13"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-13" tabindex="-1"></a>    <span class="co"># Now if z, the 97.5th percentile,</span></span>
<span id="cb32-14"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-14" tabindex="-1"></a>    <span class="co"># is 1.96 standard deviations from the mean in the normal,</span></span>
<span id="cb32-15"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-15" tabindex="-1"></a>    <span class="co"># Then so too is the 2.5th percentile in the normal.</span></span>
<span id="cb32-16"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-16" tabindex="-1"></a>    <span class="co"># Give me 1.96 standard deviations above cp </span></span>
<span id="cb32-17"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-17" tabindex="-1"></a>    <span class="co"># in the sampling distribution of cp!</span></span>
<span id="cb32-18"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-18" tabindex="-1"></a>    <span class="co"># Get upper and lower confidence interval!</span></span>
<span id="cb32-19"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-19" tabindex="-1"></a>    <span class="at">lower =</span> estimate <span class="sc">-</span> z <span class="sc">*</span> se,</span>
<span id="cb32-20"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-20" tabindex="-1"></a>    <span class="at">upper =</span> estimate <span class="sc">+</span> z <span class="sc">*</span> se)</span>
<span id="cb32-21"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-21" tabindex="-1"></a></span>
<span id="cb32-22"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb32-22" tabindex="-1"></a>bands</span></code></pre></div>
<pre><code>## # A tibble: 1 × 8
##   limit_lower limit_upper estimate v_short     se     z lower upper
##         &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1          42          50    0.671     152 0.0385  1.96 0.596 0.747</code></pre>
<p><br>
<br></p>
</div>
<div id="visualizing-confidence-intervals" class="section level3 hasAnchor" number="1.3.4">
<h3><span class="header-section-number">1.3.4</span> Visualizing Confidence Intervals<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#visualizing-confidence-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Were we to visualize this, it might look like…</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb34-1" tabindex="-1"></a>bands <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb34-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;Cp Index&quot;</span>, <span class="at">y =</span> estimate, </span>
<span id="cb34-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb34-3" tabindex="-1"></a>                       <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb34-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb34-4" tabindex="-1"></a>  <span class="co"># Get draw us some benchmarks to make our chart meaningful</span></span>
<span id="cb34-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb34-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">color =</span> <span class="fu">c</span>(<span class="st">&quot;grey&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;grey&quot;</span>)) <span class="sc">+</span></span>
<span id="cb34-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb34-6" tabindex="-1"></a>  <span class="co"># Draw the points!</span></span>
<span id="cb34-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb34-7" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb34-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb34-8" tabindex="-1"></a>  <span class="fu">geom_linerange</span>() <span class="sc">+</span></span>
<span id="cb34-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb34-9" tabindex="-1"></a>  <span class="co"># Add theming</span></span>
<span id="cb34-10"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb34-10" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb34-11"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb34-11" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb34-12"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb34-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Index Value&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="06_workshop_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>It’s not the most exciting plot, but it does show very clearly that the value of <span class="math inline">\(C_{p}\)</span> and its 95% confidence interval are nowhere even close to 1.0, the key threshold. This means we can say with 95% confidence that the true value of <span class="math inline">\(C_{p}\)</span> is <strong>less than 1</strong>.</p>
<p><br>
<br></p>
</div>
<div id="bootstrapping-c_p" class="section level3 hasAnchor" number="1.3.5">
<h3><span class="header-section-number">1.3.5</span> Bootstrapping <span class="math inline">\(C_{p}\)</span><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#bootstrapping-c_p" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>How might we estimate this using the bootstrap?</p>
<p>Well, we could…</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb35-1" tabindex="-1"></a>myboot <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb35-2" tabindex="-1"></a>  <span class="co"># For each rep,</span></span>
<span id="cb35-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb35-3" tabindex="-1"></a>  <span class="fu">group_by</span>(rep) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb35-4" tabindex="-1"></a>  <span class="co"># Give me the data.frame water,</span></span>
<span id="cb35-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb35-5" tabindex="-1"></a>  <span class="fu">summarize</span>(water) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb35-6" tabindex="-1"></a>  <span class="co"># And give me a random sample of observations</span></span>
<span id="cb35-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb35-7" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="at">size =</span> <span class="fu">n</span>(), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb35-8" tabindex="-1"></a>  </span>
<span id="cb35-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb35-9" tabindex="-1"></a>myboot <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 160,000
## Columns: 6
## Groups: rep [1,000]
## $ rep    &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ id     &lt;dbl&gt; 98, 134, 11, 12, 97, 45, 16, 10, 74, 18, 47, 122, 52, 158, 35, …
## $ time   &lt;dbl&gt; 9, 13, 1, 1, 9, 5, 1, 1, 7, 1, 5, 13, 5, 15, 3, 1, 9, 3, 5, 9, …
## $ temp   &lt;dbl&gt; 44.7, 41.5, 46.4, 44.2, 44.4, 44.4, 43.9, 43.4, 45.5, 45.9, 44.…
## $ ph     &lt;dbl&gt; 4.4, 4.7, 5.8, 5.3, 5.9, 5.5, 4.8, 5.9, 5.2, 6.6, 6.1, 4.9, 5.4…
## $ sulfur &lt;dbl&gt; 0.5, 0.8, 0.7, 1.1, 0.3, 0.0, 0.2, 0.1, 0.4, 0.3, 0.4, 0.8, 0.0…</code></pre>
<p>This produces a very, very big data.frame!</p>
<p>Let’s now, for each rep, calculate our statistics from before!</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-1" tabindex="-1"></a>mybootstat <span class="ot">=</span> myboot <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-2" tabindex="-1"></a>  <span class="co"># For each rep, and each subgroup...</span></span>
<span id="cb37-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-3" tabindex="-1"></a> <span class="fu">group_by</span>(rep, time) <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-4" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb37-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-5" tabindex="-1"></a>    <span class="at">xbar =</span> <span class="fu">mean</span>(temp),  <span class="co"># Get within group mean</span></span>
<span id="cb37-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-6" tabindex="-1"></a>    <span class="at">sigma_w =</span> <span class="fu">sd</span>(temp),  <span class="co"># Get within group sigma</span></span>
<span id="cb37-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-7" tabindex="-1"></a>    <span class="at">n_w =</span> <span class="fu">n</span>()             <span class="co"># Get within subgroup size</span></span>
<span id="cb37-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-9" tabindex="-1"></a>  <span class="co"># For each rep...</span></span>
<span id="cb37-10"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-10" tabindex="-1"></a>  <span class="fu">group_by</span>(rep) <span class="sc">%&gt;%</span></span>
<span id="cb37-11"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-11" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb37-12"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-12" tabindex="-1"></a>    <span class="at">limit_upper =</span> <span class="dv">42</span>,</span>
<span id="cb37-13"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-13" tabindex="-1"></a>    <span class="at">limit_lower =</span> <span class="dv">50</span>,</span>
<span id="cb37-14"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-14" tabindex="-1"></a>    <span class="at">xbbar =</span> <span class="fu">mean</span>(xbar),               <span class="co"># Get grand mean</span></span>
<span id="cb37-15"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-15" tabindex="-1"></a>    <span class="at">sigma_s =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(sigma_w<span class="sc">^</span><span class="dv">2</span>)), <span class="co"># Get sigma_short</span></span>
<span id="cb37-16"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-16" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">sum</span>(n_w), <span class="co"># Get total observations</span></span>
<span id="cb37-17"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-17" tabindex="-1"></a>    <span class="at">n_w =</span> <span class="fu">unique</span>(n_w)[<span class="dv">1</span>],</span>
<span id="cb37-18"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-18" tabindex="-1"></a>    <span class="at">k =</span> <span class="fu">n</span>(),   <span class="co"># Get number of subgroups k</span></span>
<span id="cb37-19"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-19" tabindex="-1"></a>    <span class="at">limit_lower =</span> <span class="dv">42</span>,</span>
<span id="cb37-20"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-20" tabindex="-1"></a>    <span class="at">limit_upper =</span> <span class="dv">50</span>,</span>
<span id="cb37-21"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb37-21" tabindex="-1"></a>    <span class="at">estimate =</span> <span class="fu">cp</span>(sigma_s, <span class="at">upper =</span> limit_upper, <span class="at">lower =</span> limit_lower))</span></code></pre></div>
<p>So cool! We’ve now generated the sampling distributions for <code>xbbar</code>, <code>sigma_s</code>, and <code>cp</code>!</p>
<p>We can even visualize the raw distributions now! Look at those wicked cool bootstrapped sampling distributions!!!</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb38-1" tabindex="-1"></a>g <span class="ot">=</span> mybootstat <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb38-2" tabindex="-1"></a>  <span class="co"># For each rep,</span></span>
<span id="cb38-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb38-3" tabindex="-1"></a>  <span class="fu">group_by</span>(rep) <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb38-4" tabindex="-1"></a>  <span class="co"># Stack our values atop each other...</span></span>
<span id="cb38-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb38-5" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb38-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb38-6" tabindex="-1"></a>    <span class="co"># Get these names, and repeat them each n times</span></span>
<span id="cb38-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb38-7" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;xbbar&quot;</span>, <span class="st">&quot;sigma_s&quot;</span>, <span class="st">&quot;cp&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">rep</span>(<span class="at">each =</span> <span class="fu">n</span>()),</span>
<span id="cb38-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb38-8" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">c</span>(xbbar, sigma_s, estimate)) <span class="sc">%&gt;%</span></span>
<span id="cb38-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb38-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb38-10"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb38-10" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb38-11"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb38-11" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-12"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb38-12" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb38-13"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb38-13" tabindex="-1"></a><span class="co"># View it!</span></span>
<span id="cb38-14"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb38-14" tabindex="-1"></a>g</span></code></pre></div>
<p><img src="06_workshop_files/figure-html/unnamed-chunk-22-1.png" width="672" />
So last, let’s take our boostrapped <span class="math inline">\(C_{p}\)</span> statistics in <code>mybootstat$cp</code> and estimate a confidence interval and standard error for this sampling distribution.</p>
<p>Because we have the <em>entire distribution</em>, we can extract values at specific percentiles in the distribution using <code>quantiles()</code>, rather than <code>qnorm()</code> or such theoretical distributions.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb39-1" tabindex="-1"></a><span class="co"># We&#39;ll save it as &#39;myqi&#39;, for quantities of interest</span></span>
<span id="cb39-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb39-2" tabindex="-1"></a>myqi <span class="ot">=</span> mybootstat <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb39-3" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb39-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb39-4" tabindex="-1"></a>    <span class="co"># Let&#39;s grab the original cp statistic</span></span>
<span id="cb39-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb39-5" tabindex="-1"></a>    <span class="at">cp =</span> bands<span class="sc">$</span>estimate,</span>
<span id="cb39-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb39-6" tabindex="-1"></a>    <span class="co"># Get the lower and upper 95% confidence intervals</span></span>
<span id="cb39-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb39-7" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">quantile</span>(estimate, <span class="at">probs =</span> <span class="fl">0.025</span>),</span>
<span id="cb39-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb39-8" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fu">quantile</span>(estimate, <span class="at">probs =</span> <span class="fl">0.975</span>),</span>
<span id="cb39-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb39-9" tabindex="-1"></a>    <span class="co"># We can even get the standard error,</span></span>
<span id="cb39-10"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb39-10" tabindex="-1"></a>    <span class="co"># which is *literally* the standard deviation of this sampling distribution</span></span>
<span id="cb39-11"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb39-11" tabindex="-1"></a>    <span class="at">se =</span> <span class="fu">sd</span>(estimate))</span>
<span id="cb39-12"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb39-12" tabindex="-1"></a></span>
<span id="cb39-13"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb39-13" tabindex="-1"></a><span class="co"># Check it out!</span></span>
<span id="cb39-14"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb39-14" tabindex="-1"></a>myqi</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##      cp lower upper     se
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 0.671 0.615 0.783 0.0438</code></pre>
<p>This suggests a wider confidence interval that our normal distribution assumes by default - interesting!</p>
<p>We can perform bootstrapping to estimate confidence intervals for <em>any</em> statistic, including <span class="math inline">\(C_{p}\)</span>, <span class="math inline">\(C_{pk}\)</span>, <span class="math inline">\(P_{p}\)</span>, or <span class="math inline">\(P_{pk}\)</span>. The only limit is your computational power! Wheee!</p>
<p><em>Note</em>: Whenever you bootstrap, it’s important that you clear out your <code>R</code> environment to keep things running quickly, because you tend to accumulate a lot of really big data.frames. You can use <code>remove()</code> to do this.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb41-1" tabindex="-1"></a><span class="fu">remove</span>(myboot, mybootstat)</span></code></pre></div>
<p><br>
<br></p>
</div>
</div>
<div id="cis-for-any-index" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> CIs for any Index!<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cis-for-any-index" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s practice calculating confidence intervals (CIs) for each of these indices.</p>
<p><br>
<br></p>
<div id="cis-for-p_p" class="section level3 hasAnchor" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> CIs for <span class="math inline">\(P_p\)</span><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cis-for-p_p" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that we have our ingredients, let’s get our index and its confidence intervals!</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-1" tabindex="-1"></a><span class="co"># Capability Index (for centered, normal data)</span></span>
<span id="cb42-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-2" tabindex="-1"></a>cp <span class="ot">=</span> <span class="cf">function</span>(sigma_s, upper, lower){  <span class="fu">abs</span>(upper <span class="sc">-</span> lower) <span class="sc">/</span> (<span class="dv">6</span><span class="sc">*</span>sigma_s)   }</span>
<span id="cb42-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-3" tabindex="-1"></a></span>
<span id="cb42-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-4" tabindex="-1"></a></span>
<span id="cb42-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-5" tabindex="-1"></a>stat <span class="sc">%&gt;%</span> </span>
<span id="cb42-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-6" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb42-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-7" tabindex="-1"></a>    <span class="co"># index</span></span>
<span id="cb42-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-8" tabindex="-1"></a>    <span class="at">estimate =</span> <span class="fu">cp</span>(<span class="at">sigma_s =</span> sigma_s, <span class="at">lower =</span> <span class="dv">42</span>, <span class="at">upper =</span> <span class="dv">50</span>),</span>
<span id="cb42-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-9" tabindex="-1"></a>    <span class="co"># Get our extra quantities of interest</span></span>
<span id="cb42-10"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-10" tabindex="-1"></a>    <span class="at">v_short =</span> k<span class="sc">*</span>(n_w <span class="sc">-</span> <span class="dv">1</span>), <span class="co"># get degrees of freedom</span></span>
<span id="cb42-11"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-11" tabindex="-1"></a>    <span class="co"># Get standard error for cpk</span></span>
<span id="cb42-12"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-12" tabindex="-1"></a>    <span class="at">se =</span> estimate <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span><span class="sc">*</span>v_short)),</span>
<span id="cb42-13"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-13" tabindex="-1"></a>    <span class="co"># Get z score</span></span>
<span id="cb42-14"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-14" tabindex="-1"></a>    <span class="at">z =</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>), <span class="co"># get position of 97.5th percentile in normal distribution</span></span>
<span id="cb42-15"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-15" tabindex="-1"></a>    <span class="co"># Get upper and lower confidence interval!</span></span>
<span id="cb42-16"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-16" tabindex="-1"></a>    <span class="at">lower =</span> estimate <span class="sc">-</span> z <span class="sc">*</span> se,</span>
<span id="cb42-17"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb42-17" tabindex="-1"></a>    <span class="at">upper =</span> estimate <span class="sc">+</span> z <span class="sc">*</span> se)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   estimate v_short     se     z lower upper
##      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1    0.671     152 0.0385  1.96 0.596 0.747</code></pre>
</div>
<div id="cis-for-c_pk" class="section level3 hasAnchor" number="1.4.2">
<h3><span class="header-section-number">1.4.2</span> CIs for <span class="math inline">\(C_{pk}\)</span><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cis-for-c_pk" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Write the function and generate the confidence interval for <span class="math inline">\(P_{pk}\)</span>!</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-1" tabindex="-1"></a><span class="co"># Capability Index (for skewed, uncentered data)</span></span>
<span id="cb44-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-2" tabindex="-1"></a>cpk <span class="ot">=</span> <span class="cf">function</span>(mu, sigma_s, <span class="at">lower =</span> <span class="cn">NULL</span>, <span class="at">upper =</span> <span class="cn">NULL</span>){</span>
<span id="cb44-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-3" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(lower)){</span>
<span id="cb44-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-4" tabindex="-1"></a>    a <span class="ot">=</span> <span class="fu">abs</span>(mu <span class="sc">-</span> lower) <span class="sc">/</span> (<span class="dv">3</span> <span class="sc">*</span> sigma_s)</span>
<span id="cb44-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-5" tabindex="-1"></a>  }</span>
<span id="cb44-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-6" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(upper)){</span>
<span id="cb44-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-7" tabindex="-1"></a>    b <span class="ot">=</span> <span class="fu">abs</span>(upper <span class="sc">-</span> mu) <span class="sc">/</span>  (<span class="dv">3</span> <span class="sc">*</span> sigma_s)</span>
<span id="cb44-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-8" tabindex="-1"></a>  }</span>
<span id="cb44-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-9" tabindex="-1"></a>  <span class="co"># We can also write if else statements like this</span></span>
<span id="cb44-10"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-10" tabindex="-1"></a>  <span class="co"># If we got both stats, return the min!</span></span>
<span id="cb44-11"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-11" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(lower) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(upper)){</span>
<span id="cb44-12"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-12" tabindex="-1"></a>    <span class="fu">min</span>(a,b) <span class="sc">%&gt;%</span> <span class="fu">return</span>()</span>
<span id="cb44-13"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-13" tabindex="-1"></a>    </span>
<span id="cb44-14"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-14" tabindex="-1"></a>    <span class="co"># If we got just the upper stat, return b (for upper)</span></span>
<span id="cb44-15"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-15" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">is.null</span>(lower)){ <span class="fu">return</span>(b) </span>
<span id="cb44-16"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-16" tabindex="-1"></a>    </span>
<span id="cb44-17"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-17" tabindex="-1"></a>    <span class="co"># If we got just the lower stat, return a (for lower)</span></span>
<span id="cb44-18"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-18" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">is.null</span>(upper)){ <span class="fu">return</span>(a) }</span>
<span id="cb44-19"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-19" tabindex="-1"></a>}</span>
<span id="cb44-20"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-20" tabindex="-1"></a></span>
<span id="cb44-21"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-21" tabindex="-1"></a></span>
<span id="cb44-22"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-22" tabindex="-1"></a>stat <span class="sc">%&gt;%</span> </span>
<span id="cb44-23"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-23" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb44-24"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-24" tabindex="-1"></a>    <span class="co"># index</span></span>
<span id="cb44-25"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-25" tabindex="-1"></a>    <span class="at">estimate =</span> <span class="fu">cpk</span>(<span class="at">mu =</span> xbbar, <span class="at">sigma_s =</span> sigma_s, <span class="at">lower =</span> <span class="dv">42</span>, <span class="at">upper =</span> <span class="dv">50</span>),</span>
<span id="cb44-26"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-26" tabindex="-1"></a>    <span class="co"># Get our extra quantities of interest</span></span>
<span id="cb44-27"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-27" tabindex="-1"></a>    <span class="at">v_short =</span> k<span class="sc">*</span>(n_w <span class="sc">-</span> <span class="dv">1</span>), <span class="co"># get degrees of freedom</span></span>
<span id="cb44-28"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-28" tabindex="-1"></a>    <span class="co"># Get standard error for ppk</span></span>
<span id="cb44-29"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-29" tabindex="-1"></a>    <span class="at">se =</span> estimate <span class="sc">*</span> <span class="fu">sqrt</span>( <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span><span class="sc">*</span>v_short)  <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">9</span> <span class="sc">*</span> n <span class="sc">*</span> estimate<span class="sc">^</span><span class="dv">2</span>) ),</span>
<span id="cb44-30"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-30" tabindex="-1"></a>    <span class="co"># Get z score</span></span>
<span id="cb44-31"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-31" tabindex="-1"></a>    <span class="at">z =</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>), <span class="co"># get position of 97.5th percentile in normal distribution</span></span>
<span id="cb44-32"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-32" tabindex="-1"></a>    <span class="co"># Get upper and lower confidence interval!</span></span>
<span id="cb44-33"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-33" tabindex="-1"></a>    <span class="at">lower =</span> estimate <span class="sc">-</span> z <span class="sc">*</span> se,</span>
<span id="cb44-34"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb44-34" tabindex="-1"></a>    <span class="at">upper =</span> estimate <span class="sc">+</span> z <span class="sc">*</span> se)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   estimate v_short     se     z lower upper
##      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1    0.478     152 0.0380  1.96 0.404 0.553</code></pre>
</div>
<div id="cis-for-p_p-1" class="section level3 hasAnchor" number="1.4.3">
<h3><span class="header-section-number">1.4.3</span> CIs for <span class="math inline">\(P_p\)</span><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cis-for-p_p-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that we have our ingredients, let’s get our index and its confidence intervals!</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-1" tabindex="-1"></a><span class="co"># Suppose we&#39;re looking at the entire process!</span></span>
<span id="cb46-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-2" tabindex="-1"></a></span>
<span id="cb46-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-3" tabindex="-1"></a><span class="co"># Process Performance Index (for centered, normal data)</span></span>
<span id="cb46-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-4" tabindex="-1"></a>pp <span class="ot">=</span> <span class="cf">function</span>(sigma_t, upper, lower){  <span class="fu">abs</span>(upper <span class="sc">-</span> lower) <span class="sc">/</span> (<span class="dv">6</span><span class="sc">*</span>sigma_t)   }</span>
<span id="cb46-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-5" tabindex="-1"></a></span>
<span id="cb46-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-6" tabindex="-1"></a></span>
<span id="cb46-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-7" tabindex="-1"></a>stat <span class="sc">%&gt;%</span> </span>
<span id="cb46-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-8" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb46-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-9" tabindex="-1"></a>    <span class="co"># index</span></span>
<span id="cb46-10"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-10" tabindex="-1"></a>    <span class="at">estimate =</span> <span class="fu">pp</span>(<span class="at">sigma_t =</span> sigma_t, <span class="at">lower =</span> <span class="dv">42</span>, <span class="at">upper =</span> <span class="dv">50</span>),</span>
<span id="cb46-11"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-11" tabindex="-1"></a>    <span class="co"># Get our extra quantities of interest</span></span>
<span id="cb46-12"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-12" tabindex="-1"></a>    <span class="at">v_total =</span> n_w<span class="sc">*</span>k <span class="sc">-</span> <span class="dv">1</span>, <span class="co"># get degrees of freedom</span></span>
<span id="cb46-13"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-13" tabindex="-1"></a>    <span class="co"># Get standard error for cpk</span></span>
<span id="cb46-14"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-14" tabindex="-1"></a>    <span class="at">se =</span> estimate <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span><span class="sc">*</span>v_total)),</span>
<span id="cb46-15"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-15" tabindex="-1"></a>    <span class="co"># Get z score</span></span>
<span id="cb46-16"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-16" tabindex="-1"></a>    <span class="at">z =</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>), <span class="co"># get position of 97.5th percentile in normal distribution</span></span>
<span id="cb46-17"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-17" tabindex="-1"></a>    <span class="co"># Get upper and lower confidence interval!</span></span>
<span id="cb46-18"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-18" tabindex="-1"></a>    <span class="at">lower =</span> estimate <span class="sc">-</span> z <span class="sc">*</span> se,</span>
<span id="cb46-19"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb46-19" tabindex="-1"></a>    <span class="at">upper =</span> estimate <span class="sc">+</span> z <span class="sc">*</span> se)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   estimate v_total     se     z lower upper
##      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1    0.670     159 0.0376  1.96 0.597 0.744</code></pre>
<p><br>
<br></p>
</div>
<div id="cis-for-p_pk" class="section level3 hasAnchor" number="1.4.4">
<h3><span class="header-section-number">1.4.4</span> CIs for <span class="math inline">\(P_{pk}\)</span><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cis-for-p_pk" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Write the function and generate the confidence interval for <span class="math inline">\(P_{pk}\)</span>!</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-1" tabindex="-1"></a><span class="co"># Process Performance Index (for skewed, uncentered data)</span></span>
<span id="cb48-2"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-2" tabindex="-1"></a>ppk <span class="ot">=</span> <span class="cf">function</span>(mu, sigma_t, <span class="at">lower =</span> <span class="cn">NULL</span>, <span class="at">upper =</span> <span class="cn">NULL</span>){</span>
<span id="cb48-3"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-3" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(lower)){</span>
<span id="cb48-4"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-4" tabindex="-1"></a>    a <span class="ot">=</span> <span class="fu">abs</span>(mu <span class="sc">-</span> lower) <span class="sc">/</span> (<span class="dv">3</span> <span class="sc">*</span> sigma_t)</span>
<span id="cb48-5"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-5" tabindex="-1"></a>  }</span>
<span id="cb48-6"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-6" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(upper)){</span>
<span id="cb48-7"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-7" tabindex="-1"></a>    b <span class="ot">=</span> <span class="fu">abs</span>(upper <span class="sc">-</span> mu) <span class="sc">/</span>  (<span class="dv">3</span> <span class="sc">*</span> sigma_t)</span>
<span id="cb48-8"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-8" tabindex="-1"></a>  }</span>
<span id="cb48-9"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-9" tabindex="-1"></a>  <span class="co"># We can also write if else statements like this</span></span>
<span id="cb48-10"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-10" tabindex="-1"></a>  <span class="co"># If we got both stats, return the min!</span></span>
<span id="cb48-11"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-11" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(lower) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(upper)){</span>
<span id="cb48-12"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-12" tabindex="-1"></a>    <span class="fu">min</span>(a,b) <span class="sc">%&gt;%</span> <span class="fu">return</span>()</span>
<span id="cb48-13"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-13" tabindex="-1"></a>    </span>
<span id="cb48-14"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-14" tabindex="-1"></a>    <span class="co"># If we got just the upper stat, return b (for upper)</span></span>
<span id="cb48-15"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-15" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">is.null</span>(lower)){ <span class="fu">return</span>(b) </span>
<span id="cb48-16"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-16" tabindex="-1"></a>    </span>
<span id="cb48-17"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-17" tabindex="-1"></a>    <span class="co"># If we got just the lower stat, return a (for lower)</span></span>
<span id="cb48-18"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-18" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">is.null</span>(upper)){ <span class="fu">return</span>(a) }</span>
<span id="cb48-19"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-19" tabindex="-1"></a>}</span>
<span id="cb48-20"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-20" tabindex="-1"></a></span>
<span id="cb48-21"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-21" tabindex="-1"></a>stat <span class="sc">%&gt;%</span> </span>
<span id="cb48-22"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-22" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb48-23"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-23" tabindex="-1"></a>    <span class="co"># index</span></span>
<span id="cb48-24"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-24" tabindex="-1"></a>    <span class="at">estimate =</span> <span class="fu">ppk</span>(<span class="at">mu =</span> xbbar, <span class="at">sigma_t =</span> sigma_t, <span class="at">lower =</span> <span class="dv">42</span>, <span class="at">upper =</span> <span class="dv">50</span>),</span>
<span id="cb48-25"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-25" tabindex="-1"></a>    <span class="co"># Get our extra quantities of interest</span></span>
<span id="cb48-26"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-26" tabindex="-1"></a>    <span class="at">v_total =</span> n_w<span class="sc">*</span>k <span class="sc">-</span> <span class="dv">1</span>, <span class="co"># get degrees of freedom</span></span>
<span id="cb48-27"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-27" tabindex="-1"></a>    <span class="co"># Get standard error for cpk</span></span>
<span id="cb48-28"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-28" tabindex="-1"></a>    <span class="at">se =</span> estimate <span class="sc">*</span> <span class="fu">sqrt</span>( <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span><span class="sc">*</span>v_total)  <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">9</span> <span class="sc">*</span> n <span class="sc">*</span> estimate<span class="sc">^</span><span class="dv">2</span>) ),</span>
<span id="cb48-29"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-29" tabindex="-1"></a>    <span class="co"># Get z score</span></span>
<span id="cb48-30"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-30" tabindex="-1"></a>    <span class="at">z =</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>), <span class="co"># get position of 97.5th percentile in normal distribution</span></span>
<span id="cb48-31"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-31" tabindex="-1"></a>    <span class="co"># Get upper and lower confidence interval!</span></span>
<span id="cb48-32"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-32" tabindex="-1"></a>    <span class="at">lower =</span> estimate <span class="sc">-</span> z <span class="sc">*</span> se,</span>
<span id="cb48-33"><a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#cb48-33" tabindex="-1"></a>    <span class="at">upper =</span> estimate <span class="sc">+</span> z <span class="sc">*</span> se)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   estimate v_total     se     z lower upper
##      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1    0.478     159 0.0376  1.96 0.404 0.551</code></pre>
<p><br>
<br>
<br></p>
</div>
</div>
<div id="conclusion" class="section level2 unnumbered hasAnchor">
<h2>Conclusion<a href="indices-and-confidence-intervals-for-statistical-process-control-in-r.html#conclusion" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Alright! You are now a confidence interval wizard!</p>
<p>Go forth and make confidence intervals!</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

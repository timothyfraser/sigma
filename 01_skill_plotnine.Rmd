# Visualization with `plotnine` in `Python`

```{r setup_skill_plotnine, include = FALSE}
knitr::opts_chunk$set(cache = FALSE, message = FALSE, warning = FALSE)
```

Visualization is a key part of statistical analyses, especially in systems engineering. In this tutorial, we'll learn to visualize data with `plotnine` (the Python port of `ggplot2`).

**Please follow along using the code below!**

<br>
<br>

## Getting Started {.unnumbered}

### Loading Packages {.unnumbered}

```{python}
import pandas as p
from plotnine import *
from gapminder import gapminder as gapminder
from seaborn import load_dataset

# diamonds from seaborn
diamonds = load_dataset('diamonds')
```

### Gapminder data {-}

```{python}
# View it in the console
gapminder
```

```{python}
# Glimpse-like summary
gapminder.dtypes, gapminder.shape
```

## Your first scatterplot

```{python}
ggplot(data=gapminder, mapping=aes(x='gdpPercap', y='lifeExp'))
```

Add points with `+ geom_point()`.

```{python}
(ggplot(gapminder, aes(x='gdpPercap', y='lifeExp')) + geom_point())
```

---

## Learning Check 1 {.unnumbered .LC}

**Question**

What kind of relationship does this graph show? Why might it matter to policymakers?

<details><summary>**[View Answer!]**</summary>

As wealth per person (GDP per capita) increases, life expectancy rises quickly then tapers off. This shows a strong relationship between wealth and health.

</details>

---

## Transparency (alpha)

```{python}
(ggplot(gapminder, aes(x='gdpPercap', y='lifeExp')) + geom_point(alpha=0.2))
(ggplot(gapminder, aes(x='gdpPercap', y='lifeExp')) + geom_point(alpha=0.5))
(ggplot(gapminder, aes(x='gdpPercap', y='lifeExp')) + geom_point(alpha=1))
```

---

## Learning Check 2 {.unnumbered .LC}

**Question**

What happens when you change `alpha` across the three visuals above?

<details><summary>**[View Answer!]**</summary>

`alpha` controls transparency from 0 to 1. Higher values are more opaque; lower values are more transparent.

</details>

---

## Color: constant vs mapped

```{python}
# Single color
(ggplot(gapminder, aes(x='gdpPercap', y='lifeExp')) +
  geom_point(alpha=0.5, color='steelblue'))

# Color mapped by continent
(ggplot(gapminder, aes(x='gdpPercap', y='lifeExp', color='continent')) +
  geom_point(alpha=0.5))
```

---

## Learning Check 3 {.unnumbered .LC}

**Question**

Where do you place `color` for a single color vs. multiple colors based on a variable?

<details><summary>**[View Answer!]**</summary>

Single color: set `color` inside `geom_point(color='...')` (outside `aes`). Mapped colors: set `color` inside `aes(color='variable')`.

</details>

---

## Improving our visualizations

```{python}
(ggplot(gapminder, aes(x='gdpPercap', y='lifeExp', color='continent')) +
  geom_point(alpha=0.5) +
  labs(x='GDP per capita (USD)',
       y='Life Expectancy (years)',
       color='Continent',
       title='Does Wealth affect Health?',
       subtitle='Global Health Trends by Continent',
       caption='Points display individual country-year observations.'))
```

You can save visuals as objects to reuse them.

```{python}
myviz = (ggplot(gapminder, aes(x='gdpPercap', y='lifeExp', color='continent')) +
  geom_point(alpha=0.5) +
  labs(x='GDP per capita (USD)', y='Life Expectancy (years)', color='Continent',
       title='Does Wealth affect Health?', subtitle='Global Health Trends by Continent',
       caption='Points display individual country-year observations.'))

myviz
myviz + theme_bw()
myviz + theme_dark()
myviz + theme_classic()
```

<br>
<br>

## Visualizing `diamonds` data

```{python}
diamonds.head(3)
```

```{python}
diamonds.dtypes, diamonds.shape
```

### Boxplots by cut

```{python}
(ggplot(diamonds, aes(x='cut', y='price', group='cut')) + geom_boxplot())
```

```{python}
(ggplot(diamonds, aes(x='cut', y='price', group='cut')) +
  geom_boxplot(fill='steelblue'))
```

```{python}
(ggplot(diamonds, aes(x='cut', y='price', group='cut', fill='cut')) +
  geom_boxplot())
```

---

## Learning Check 4 {.unnumbered .LC}

**Question**

Why do the two boxplot versions look different? What changed in the code to create those effects?

<details><summary>**[View Answer!]**</summary>

Constant fill uses `geom_boxplot(fill='steelblue')`. Mapped fill uses `aes(fill='cut')` to color by variable.

</details>

---

## Visualizing Distributions

```{python}
(ggplot(diamonds, aes(x='price', fill='cut')) +
  geom_histogram(color='white') +
  labs(x='Price (USD)', y='Frequency', title='US Diamond Sales'))
```

### Try adjusting binwidth and theme

```{python}
(ggplot(diamonds, aes(x='price', fill='cut')) +
  geom_histogram(color='white', binwidth=500) +
  theme_classic() +
  labs(x='Price (USD)', y='Frequency', title='US Diamond Sales (binwidth=500)'))
```

---

## Learning Check 5 {.unnumbered .LC}

**Question**

Make a histogram of `price` with a narrower binwidth and apply a different theme. Which choices improve readability?

<details><summary>**[View Answer!]**</summary>

```{python}
(ggplot(diamonds, aes(x='price', fill='cut')) +
  geom_histogram(color='white', binwidth=250) +
  theme_bw() +
  labs(x='Price (USD)', y='Frequency'))
```

</details>

---

## Conclusion {.unnumbered}

You learned how to build scatterplots, boxplots, and histograms with `plotnine` and how to control transparency, color mapping, labels, and themes.

```{python, include=FALSE}
globals().clear()
```

